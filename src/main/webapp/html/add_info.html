<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>add info</title>
<link rel="stylesheet" type="text/css" href="../static/style/common.css">
<link rel="stylesheet" type="text/css" href="../static/jqeasyui/themes/default/easyui.css">
<link rel="stylesheet" type="text/css" href="../static/jqeasyui/themes/icon.css">
<style>
.w650{width:650px;}
.h50{height:50px;}
</style>
</head>
<body>
<div style="padding:10px;width:800px;text-align:center;">
		<div id="infoAddPanle" class="easyui-panel"  title="添加信息" style="width:750px;height:1000px;margin:auto; text-align:left;">
	    <form id="infoAddFrm" method="post">
				<table cellpadding="5">
					<tr>
						<td id="title_tit">资讯标题:</td>
						<td><input class="easyui-validatebox w650 texta" type="text" name="title"
							data-options="required:true"></td>
					</tr>
					<tr>
						<td id="summary_tit">资讯摘要:</td>
						<td><textarea class="w650 h50 texta" type="text" name="summary"></textarea>
					</tr>
					<tr>
						<td id="infoType_tit">资讯类型:</td>
						<td>
							<select id="infoType" name="infoType" style="width:100px;"></select>
						</td>
					</tr>
					<tr>
						<td id="isPic_tit">有图文:</td>
						<td><select name="isPic" style="width:50px;" size="2">
								<option value="0">否</option>
								<option value="1">是</option></td>
					</tr>
					<tr>
						<td id="isVideo_tit">有视频:</td>
						<td><select name="isVideo" style="width:50px;" size="2">
								<option value="0">否</option>
								<option value="1">是</option></td>
					</tr>
					<tr>
						<td id="picUrl_tit">主图地址:</td>
						<td><input class="w650 texta" type="text" name="picUrl"></td>
					</tr>
					<tr>
						<td id="content_tit">资讯内容:</td>
						<td></td>
					</tr>
					<tr>
						<td colspan="2">
							<div style="width:95%; height: 350px; margin: auto; display: block; text-align: left;">
								<script id="editor" name="content" type="text/plain"></script>
							</div>
						</td>
					</tr>
				</table>
				<div style="text-align: center; padding: 5px">
					<a href="javascript:void(0)" class="easyui-linkbutton"
						data-options="iconCls:'icon-save'" onclick="INFO.submitAddForm();">提 交</a>
						&nbsp;&nbsp;&nbsp;&nbsp; 
					<a href="javascript:void(0)"
						class="easyui-linkbutton" data-options="iconCls:'icon-clear'"
						onclick="INFO.clearAddForm();">清 空</a>
				</div>
			</form>
	    </div>
</div>


<script src="../static/js/jquery-1.11.1.min.js"></script>
<script src="../ctx.jsp"></script>
<script src="../static/jqeasyui/jquery.easyui.min.js"></script>
<script src="../static/jqeasyui/locale/easyui-lang-zh_CN.js"></script>
<script src="../static/ueditor/ueditor.config.js"></script>
<script src="../static/ueditor/ueditor.all.min.js"></script>
<script src="../static/ueditor/lang/zh-cn/zh-cn.js"></script>
<script src="../static/js/common.js"></script>
<script src="../static/js/common-window.js"></script>
<script src="../static/js/common-form.js"></script>
<script src="../static/js/jq.md5.js"></script>
<script>
$(document).ajaxError(globalAjaxErrorHandler);

function setHeight(){
    var c = $('#infoAddPanle');
    var p = c.layout('panel','center');    // get the center panel
    var oldHeight = p.panel('panel').outerHeight();
    p.panel('resize', {height:'auto'});
    var newHeight = p.panel('panel').outerHeight();
    c.layout('resize',{
        height: (c.height() + newHeight - oldHeight)
    });
};
	var INFO = {};
	INFO.JQ_ADD_FORM = $('#infoAddFrm');
	INFO.submitAddForm = function() {
	this.JQ_ADD_FORM.form('submit', {
			ajax : true,
			queryParams : {
				r : ut.r()
			},
			url : window.SrvCtxPath+'/info/add.json',
			onSubmit : function(params) {
				return $(this).form('enableValidation').form('validate');
			},
			success : function(data) {
				var res = jQuery.parseJSON(data)
				if (res.exception || res.validErrors && res.validErrors.length > 0) {
					var msg = [];
					var errs = res.validErrors;
					for ( var k in errs) {
						var err = errs[k].split('@');
						if (err.length == 2) {
							msg.push($('#' + err[1] + '_tit').text() + err[0]);
						} else {
							msg.push(err[0]);
						}
					}
					if(res.exception){
						msg.push(res.exception.replace(/\r|\n/,'<br/>'));
					}
					TxWebWin.alertWarn('添加失败，失败原因：<br/>' + msg.join('<br/>'));
				} else {
					alert('添加成功！');
					INFO.clearAddForm();
					$('#infoAddWin').window('close');
				}
			}
		});
	};

	var ue = UE.getEditor('editor');
	
	$(function(){
		$('#infoType').txwebInitSelect({
			'url' : window.SrvCtxPath+'/config/dict/jsonp',
			'params' : {'dictCode':'INFO_TYPE'},
			'selectedIndex' : 0,
			'callfunc':function(data, val){
				console.log(val);
			},
			'valueName':'dictValue',
			'textName':'name'
		});
	});
	


	
</script>








</body>
</html>